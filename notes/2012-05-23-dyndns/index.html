<!DOCTYPE html>
<html lang="">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dyn DNS story</title>
  <meta name="description" content="" />
  <!-- Yandex.Metrika counter -->
<meta name="yandex-verification" content="721d8d42ba7b40bb" />
<script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();
    for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
    k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
 
    ym(91297055, "init", {
         clickmap:true,
         trackLinks:true,
         accurateTrackBounce:true
    });
 </script>
 <noscript><div><img src="https://mc.yandex.ru/watch/91297055" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
 <!-- /Yandex.Metrika counter -->

  <link rel="stylesheet" href="/styles/index.css">
  <link rel="stylesheet" href="/styles/katex.min.css">
</head>

<body>
  <nav>
    <ul>
      <li><a class="internal-link" href="/"><b>Ilya&#39;s digital garden</b></a></li>
      <li><a class="internal-link" href="/talks">Talks</a></li>
      <li><a class="internal-link" href="/notes">Notes</a></li>
    </ul>
  </nav>

  <div class="wrapper">
    <main>
<article>
  <div>
    <h1>Dyn DNS story</h1>
    <time datetime="2012-05-23">23 May 2012</time>
  </div>

  <div id="notes-entry-container">
    <content>
      <blockquote>
<p>Повесть о том, как я Dyn DNS получал и сервер на ноутбуке поднимал.</p>
</blockquote>
<p><img src="https://miro.medium.com/max/650/0*v-mynggPV7aFAn3E.jpg" alt="Image for post"></p>
<h2>Основные понятия Domain Name System</h2>
<p>Исторически, до появления доменной системы имен роль инструмента разрешения символьных имен в IP выполнял файл /etc/hosts. Сейчас он выглядит примерно так.</p>
<pre><code class="hljs language-shell">[ilya@localhost ~]$ cat /etc/hosts
<span class="hljs-meta prompt_"># </span><span class="bash">/etc/hosts: static lookup table <span class="hljs-keyword">for</span> host names</span>
<span class="hljs-meta prompt_">#</span><span class="bash">&#x3C;ip-address> &#x3C;hostname.domain.org> &#x3C;hostname></span>
127.0.0.1 localhost.localdomain localhost
::1 localhost.localdomain localhost
<span class="hljs-meta prompt_"># </span><span class="bash">End of file</span>
</code></pre>
<p>Но с ростом количества хостов в глобальной сети, отслеживать и обслуживать базу имен на всех хостах стало нереально затруднительно. В результате придумали DNS, представляющую собой иерархическую, распределенную систему доменных зон. А /etc/hosts используют, например, чтобы Adobe Photoshop не качал обновления.</p>
<h2>Структура системы доменных имен</h2>
<p>Доменная структура DNS представляет собой древовидную иерархию, состоящую из узлов, зон, доменов, поддоменов и др. элементов</p>
<p><img src="https://miro.medium.com/max/1024/0*KWmL5PBYCp2FsKIE.png" alt="Image for post"></p>
<p>“Вершиной” доменной структуры является корневая зона. Настройки корневой зоны расположены на множестве серверов/зеркал, размещенных по всему миру и содержат информацию о всех серверах корневой зоны, а так же отвечающих за домены первого уровня (ru, net, org и др).(Информация о серверах корневой зоны расположена на <a href="http://www.root-servers.org/">www.root-servers.org</a>. Всего серверов 312)</p>
<p><img src="https://miro.medium.com/max/1024/0*9LhVymSuGWP7nWNw.png" alt="Image for post"></p>
<p>Серверы корневой зоны обрабатывают и отвечают на запросы, выдавая информацию только о доменах первого уровня (то есть отвечают на любые запросы, как на нерекурсивные!)</p>
<p><strong>Зона</strong> — это любая часть дерева системы доменных имен, размещаемая как единое целое на некотором DNS-сервере. Зону, для бОльшего понимания, можно назвать “зоной ответственности”. Целью выделения части дерева в отдельную зону является передача ответственности (Делегирование) за эту ветвь другому лицу или организации. В каждой зоне имеется, по крайней мере, один авторитетный сервер DNS, который хранит ВСЮ информацию о зоне, за которую он отвечает. (на картинке зоны обозначены синим.)</p>
<p><strong>Домен</strong> — это именованная ветвь или поддерево в дереве имен DNS, то есть это определенный узел, включающий в себя все подчиненные узлы. Каждый узел в иерархии DNS отделен от своего родителя точкой.А так же DNS адрес читается справа налево (от корневого домена к имени хоста). Доменное имя начинается с точки (корневого домена) и проходит через домены первого, второго и если нужно третьего и т.д. уровней и завершается именем хоста. Таким образом доменное имя полностью отражает структуру иерархии DNS.</p>
<h2>Запросы Dns</h2>
<p><strong>Итеративный</strong> (он же прямой, он же нерекурсивный) запрос посылает доменное имя DNS серверу и просит вернуть либо IP адрес этого домена, либо имя DNS сервера, авторитативного для этого домена. При этом, сервер DNS не опрашивает другие серверы для получения ответа. Так работают корневые и TLD серверы.</p>
<p><img src="https://miro.medium.com/max/1024/0*hWqUAUCrvq2FJZaC.png" alt="Image for post"></p>
<p><strong>Рекурсивный</strong> запрос посылает DNS серверу доменное имя и просит возвратить IP адрес запрошенного домена. При этом сервер может обращаться к другим DNS серверам.</p>
<ol>
<li>Клиент (браузер, почтовая программа, либо любое другое приложение) отправляет запрос резолверу, резолвер на основании указанных конфигов определяет адрес настроенного сервера имен.</li>
<li>Резолвер посылает запрос указанному серверу имен.</li>
<li>Сервер имен принимает данный рекурсивный запрос и, т.к. не имеет информации ни о домене, ни, возможно, даже о зоне name., отправляет рекурсивный (или нерекурсивный в зависимости от настроек) запрос серверу, отвечающему за корневую зону.</li>
<li>Сервер корневой зоны не обрабатывает рекурсивные запросы, в результате обрабатывает данный запрос как итеративный и возвращает имя и адрес сервера, авторитетного за зону name.</li>
<li>Сервер последовательно продолжает опрашивать авторитативные сервера для последующих зон, в порядке убывания уровня зон в имени</li>
<li>пока не получает удовлетворительный ответ, данных шагов может быть больше, в зависимости от длины доменного имени</li>
<li>и “вложенности” доменных имен.</li>
<li>В итоге, сервер получает необходимый ответ от сервера имен, хранящего необходимую ресурсную запись о хосте.</li>
<li>Сервер провайдера локальной сети возвращает резолверу клиента запрошенные данные.</li>
</ol>
<p><strong>Делегирование ответственности</strong> — это операция передачи ответственности за часть дерева доменных имен (зону) другому лицу или организации. За счет делегирования, в DNS обеспечивается распределённость администрирования и хранения зон.</p>
<p>Делегирование управления поддоменом blan4.no-ip.org мне приводит к созданию новой зоны, которая администрируется на моем ноутбуке независимо от остального пространства имен и может содержать любые доменный имена, которые я захочу, заканчивающиеся на <code>*blan4.no-ip.org</code>. С другой стороны, зона <code>no-ip.org</code>. содержит только доменные имена, оканчивающиеся на <code>*.no-ip.org</code>. Далее можно передать ответственность, например, на зону <code>ololoev.blan4.no-ip.org</code>.</p>
<p>Т.о. после передачи ответственности, информация хранимая делегирующей зоной уже не включает информацию по делегированному поддомену и его ресурсным записям хостов, а хранит информацию о серверах имен, являющихся для делегируемого поддомена авторитетными.</p>
<p><strong>Регистрация доменов</strong> — это действие, посредством которого клиент сообщает регистратору, каким DNS-серверам следует делегировать поддомен, и также снабжает регистратора контактной и платежной информацией. Регистратор передает информацию в соответствующий реестр. Чаще всего, это процесс внесения в реестр зоны первого уровня. Но зоны первого уровня стоят очень много полимеров.</p>
<p>Я же зарегестрировал себе доменное имя на сайте <a href="http://www.noip.com/">http://www.noip.com/</a>. Причина, по которой я выбрал именно этот сайт очевидна. ЭТО БЕСПЛАТНО и кроме того у них есть услуга Dyn DNS. Дело в том, что Dom.ru обеспечивает меня не статическим ip адресом и нестабильным интернетом. Следовательно, при внезапном разрыве соединения я потеряю свой адрес. Поэтому dns имя будет недействительно!!</p>
<h2>Принцип работы Dyn Dns</h2>
<p>Имя хоста с динамическим DNS привязывается к динамическому IP-адресу пользователя. Всякий раз, когда IP меняется, клиент динамического DNS направляет No-IP уведомление с указанием текущего IP-адреса и затем уже No-IP распространяет изменения в Интернете в считанные секунды.</p>
<p>Для облегчения обновления IP-адреса, No-IP имеет открытый протокол, что позволяет разработчикам открытого программного обеспечения и производителям оборудования передавать по HTTP уведомления об изменении IP-адреса.</p>
<p>Время устаревания (TTL) для динамической записи делается очень маленьким (2 минуты) иначе другие DNS-серверы поместят её в свой кэш, а когда она изменится — их клиенты долго будут получать устаревшую информацию.</p>
<h2>Практика!!</h2>
<p>Настало время сделать свой сайт с DynDNS и Apache!!</p>
<p>Регестрируемся на сайте <a href="http://www.no-ip.com/">www.no-ip.com</a>. Необходимо указать реальный почтовый адрес, потому что именно его использует программа обновления ip и dns.</p>
<p>После регистрации мы попадаем на личную страницу. Вы можете добавить новый хост или новое доменное имя.</p>
<p>На данный момент мы установили соответствие ip адреса хоста и его dns именем. Теперь необходимо установить программу для автоматического изменения ip.</p>
<h2>Как это настроить?</h2>
<p>На официальном сайте можно <a href="http://www.no-ip.com/downloads.php">скачать программу</a>, котора будет отправлять на сервер ваш новый ip адрес. Но счастливым обладателям маршрутизаторов D-Link, Sonicwall, SMC, Toshiba и ZyXEL надо просто указать в настройках устройства логин и пароль аккаунта с no-ip.org, а маршрутизатор уже сам все будет делать! Кстати, необходимо объяснить роутеру, где именно находится наш домашний сервер. Для этого придется пробросить порты.</p>
    </content>
  </div>
</article></main>
  </div>
</body>

</html>